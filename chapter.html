<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Chapter Viewer</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background-color: #f4f4f4;
        }
        
        #image-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
        }

        img {
            max-width: 100%;
            height: auto;
            margin: 0;
            padding: 0;
        }

        h1 {
            font-size: 24px;
            text-align: center;
            margin: 10px 0;
        }

        @media only screen and (max-width: 600px) {
            h1 {
                font-size: 20px;
            }
        }

        /* Style untuk loading spinner */
        #loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            text-align: center;
        }

        #spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
            margin-bottom: 10px;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
    </style>
    <script>
        let chapterLoaded = 0;
        let totalChapters = 51; // Ganti ini sesuai jumlah total chapter

        // Fungsi untuk memuat chapter
        async function loadChapter() {
            const hash = window.location.hash.substring(1);
            const baseChapterNumber = parseInt(hash.split(".")[0]);
            const subChapter = hash.split(".")[1] || ""; 
            const serverNumber = (baseChapterNumber + chapterLoaded) % 51 + 1; 
            const chapterPath = `${(baseChapterNumber + chapterLoaded).toString().padStart(3, '0')}${subChapter ? '.' + subChapter : ''}`;

            const imageContainer = document.getElementById('image-container');
            let imageFound = false;

            document.getElementById('loading').style.display = 'block'; // Tampilkan loading

            for (let i = 0; i < 100; i++) {
                const imageUrl = `https://sv${serverNumber}.imgkc${serverNumber}.my.id/wp-content/img/T/Tsue-to-Tsurugi-no-Wistoria/${chapterPath}/${i.toString().padStart(3, '0')}.jpg`;

                const img = document.createElement('img');
                img.src = imageUrl;

                await checkImage(img.src)
                    .then(() => {
                        imageContainer.appendChild(img); 
                        imageFound = true;
                    })
                    .catch(() => {
                        if (!imageFound) {
                            console.log("No more images found.");
                        }
                    });

                if (!imageFound) break;
            }

            document.getElementById('loading').style.display = 'none'; // Sembunyikan loading

            chapterLoaded++; // Tambah counter chapter yang dimuat
        }

        // Fungsi untuk mengecek gambar
        function checkImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(url);
                img.onerror = () => reject(url);
                img.src = url;
            });
        }

        // Fungsi untuk mendeteksi saat scroll mencapai akhir halaman
        function onScroll() {
            const scrollPosition = window.innerHeight + window.scrollY;
            const bottomPosition = document.body.offsetHeight - 50; // Margin kecil sebelum benar-benar di bawah

            if (scrollPosition >= bottomPosition && chapterLoaded < totalChapters) {
                loadChapter(); // Muat chapter berikutnya
            }
        }

        // Tambahkan event listener untuk scroll
        window.addEventListener('scroll', onScroll);

        // Muat chapter pertama saat halaman dimuat
        window.onload = loadChapter;
    </script>
</head>
<body>
    <h1>Chapter Viewer</h1>
    <div id="image-container"></div>

    <!-- Loading spinner -->
    <div id="loading">
        <div id="spinner"></div>
        <p>Loading...</p>
    </div>
</body>
</html>
